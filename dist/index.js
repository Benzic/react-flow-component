!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react")):"function"==typeof define&&define.amd?define(["react"],e):"object"==typeof exports?exports.laputarednerer=e(require("react")):t.laputarednerer=e(t.react)}(window,(function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1);Object.defineProperty(e,"MultipleFlow",{enumerable:!0,get:function(){return i.default}})},function(t,e,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.hasOwnProperty.call(t,n)&&i(e,t,n);return o(e,t),e},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s(n(2)),h=n(3),c=r(n(4));n(6);e.default=({flowNodes:t=[],rectConfig:e,lineConfig:n,gradConfig:i,onChange:o,onDBClick:s,onChangePosition:r})=>{const l=a.useRef(null),d=a.useRef(null),u=a.useRef(null),f=new c.default(t=>{u.current.resize(t[0].contentRect)});return a.useEffect(()=>{f.observe(d.current),u.current=new h.Flow({flowNodes:t,canvas:l.current,wrapper:d.current,rectConfig:e,lineConfig:n,gradConfig:i,onChange:o,onDBClick:s,onChangePosition:r})},[]),a.useEffect(()=>{u.current.nodes=t,u.current.resetValues()},[t]),a.default.createElement("div",{ref:d,style:{width:"100%",height:"100%",position:"relative"}},a.default.createElement("canvas",{ref:l,id:"canvas"}))}},function(e,n){e.exports=t},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Flow=void 0;e.Flow=class{constructor({flowNodes:t,canvas:e,wrapper:n,rectConfig:i,lineConfig:o,gradConfig:s,onChange:r,onDBClick:a,onChangePosition:h}){this.selectArea={startX:0,startY:0,endX:0,endY:0},this.activeLines=[],this.activeKey=null,this.lastMouseUpTime=0,this.editLine=null,this.activeTool=null,this.mouseDownXY={x:0,y:0},this.translateX=0,this.translateY=0,this.singleClick=!0,this.cancelDBClick=!1,this.leftMouseDown=!1,this.drawElement=null,this.drawLineModel=!1,this.lineFormNodeKey=null,this.throttle=(t,e=500)=>{let n=!0;const i=e;return function(...e){n&&(t.apply(this,e),n=!1,setTimeout(()=>{n=!0},i))}},this.onListenKeyDown=()=>{window.onkeydown=t=>{var e;46===t.keyCode&&((null===(e=this.activeLines)||void 0===e?void 0:e.length)&&this.deleLine(),this.activeKey&&this.deleRect(),this.render()),17===t.keyCode&&(window.document.body.style.cursor="move")}},this.onListenKeyUp=()=>{window.onkeyup=t=>{17===t.keyCode&&(window.document.body.style.cursor="inherit")}},this.onConectLine=(t,e)=>{const n=this.getRectIndex(this.lineFormNodeKey)||0,{height:i}=this.rectCfg,{width:o}=this.lineCfg;this.render(),this.drawLine({sx:this.nodes[n].x+this.translateX,sy:this.nodes[n].y+this.translateY,x:t,y:e,_w:o,_h:i/2})},this.onListenMouseMove=t=>{let{clientX:e,clientY:n}=t;this.canvas.onmousemove=t=>{var i,o;const{clientX:s,clientY:r,ctrlKey:a,offsetX:h,offsetY:c}=t;if(this.drawLineModel)this.onConectLine(h,c);else{const{leftMouseDown:t,activeKey:l,rectCfg:d,lineCfg:u}=this;if(a&&t){const t=s-e,o=r-n;e=s,n=r,this.translateX+=t,this.translateY+=o,null===(i=this.onChangePosition)||void 0===i||i.call(this,{translateX:this.translateX,translateY:this.translateY}),this.render()}if(!a){const{xCorrecting:t=10,yCorrecting:e=5,height:n}=d,{width:i}=u,{width:s,height:r}=this.canvas;if(null!==l){const s=null!==(o=this.getRectIndex(l))&&void 0!==o?o:0;if(this.singleClick){if(this.render(),this.nodes[s].active){const n=(h-this.translateX)/t,i=(c-this.translateY)/e;this.nodes[s].x=Math.floor(n)*t,this.nodes[s].y=Math.floor(i)*e}}else this.render(),this.drawLine({sx:this.nodes[s].x+this.translateX,sy:this.nodes[s].y+this.translateY,x:h,y:c,_w:i,_h:n/2})}else this.selectArea.startX=this.mouseDownXY.x-this.translateX,this.selectArea.startY=this.mouseDownXY.y-this.translateY,this.selectArea.endX=h-this.translateX,this.selectArea.endY=c-this.translateY,this.render(),this.dragSelect(this.mouseDownXY.x,this.mouseDownXY.y,h,c)}}}},this.onConectNode=(t,e)=>{var n,i,o;const{levelLimit:s}=this.lineCfg;s&&(null===(n=e.point)||void 0===n?void 0:n.level)<(null===(i=this.nodes[t])||void 0===i?void 0:i.level)||(this.nodes[t]=Object.assign(Object.assign({},this.nodes[t]),{toNodes:[...this.nodes[t].toNodes,e.key],active:!1}),null===(o=this.onChange)||void 0===o||o.call(this,this.nodes))},this.onListenMouseUp=()=>{window.onmouseup=t=>{var e;const{buttons:n}=t;if(1!==n&&(this.leftMouseDown=!1),!this.drawLineModel){const{offsetX:n,offsetY:i}=t,{activeKey:o,lastMouseUpTime:s,mouseDownXY:r}=this,{x:a,y:h}=r;if(Math.abs(a-n)>10||Math.abs(h-i)>10?this.cancelDBClick=!0:this.cancelDBClick=!1,null!==o){const t=this.findRectInCanvas(n-this.translateX,i-this.translateY),s=null!==(e=this.getRectIndex(o))&&void 0!==e?e:0;t&&(null==t?void 0:t.key)!==o&&this.onConectNode(s,t),this.render()}else{const t=(new Date).valueOf()-s.valueOf()>150;null===o&&t&&this.findLineInCanvas(),this.render()}this.canvas.onmousemove=null}}},this.onDragRect=t=>{this.onListenMouseMove(t),this.onListenMouseUp()},this.onListenOnMouseDown=()=>{this.canvas.onmousedown=t=>{var e;this.activeKey=null;const{offsetX:n,offsetY:i,buttons:o,ctrlKey:s}=t;if(this.leftMouseDown=1===o,this.drawLineModel){const e=this.findRectInCanvas(n-this.translateX,i-this.translateY);if(e)if(this.lineFormNodeKey){const t=this.lineFormNodeKey,n=this.getRectIndex(t);this.nodes[n].toNodes.includes(null==e?void 0:e.key)||t===(null==e?void 0:e.key)||this.onConectNode(n,e),this.lineFormNodeKey=null,this.activeKey=null,this.canvas.onmousemove=null,this.render()}else this.lineFormNodeKey=null==e?void 0:e.key,this.onListenMouseMove(t);else this.canvas.onmousemove=null,this.lineFormNodeKey=null,this.render()}else if(s)this.onListenMouseMove(t);else{const o=this.findRectInCanvas(n-this.translateX,i-this.translateY),{lastMouseUpTime:s}=this;if(s){const t=(new Date).valueOf()-s.valueOf()<250;this.singleClick=!t}if(this.lastMouseUpTime=(new Date).getTime(),this.mouseDownXY.x=n,this.mouseDownXY.y=i,o){this.activeKey=null==o?void 0:o.key,this.editLine=null,this.activeLines=[];const t=this.getRectIndex(null==o?void 0:o.key),n=this.nodes[t];n&&(this.nodes.splice(t,1),this.nodes.push(Object.assign(Object.assign({},n),{active:!0})),null===(e=this.onChange)||void 0===e||e.call(this,this.nodes),this.render())}this.onDragRect(t)}}},this.render=()=>{var t,e;this.ctx&&(this.ctx.clearRect(0,0,null===(t=this.canvas)||void 0===t?void 0:t.width,null===(e=this.canvas)||void 0===e?void 0:e.height),this.ctx.save(),this.ctx.translate(this.translateX,this.translateY),this.gradConfig&&this.drawDrid(),this.initCanvas(),this.ctx.restore())},this.drawNodeInCanvas=t=>{var e,n,i,o;const{nodes:s,rectCfg:r,activeKey:a}=this,{width:h,height:c,corner:l,bgImg:d,activeBgColor:u,bgColor:f,tool:v,textAlign:p,textMargin:g,shadowBlur:x,shadowColor:y}=r,w=s[t],b=null!==(e=w.tool)&&void 0!==e?e:v;this.drawRoundedRect({x:w.x,y:w.y,r:null!==(n=w.corner)&&void 0!==n?n:l,active:a===w.key,bgImg:null!==(i=w.bgImg)&&void 0!==i?i:d,hWidth:h/2,hHeight:c/2,bgColor:f,aBgColor:u,shadowBlur:x,shadowColor:y}),this.drawText({x:w.x,y:w.y,margin:g,align:p,title:w.name,active:a===w.key,hWidth:h/2,r:null!==(o=w.corner)&&void 0!==o?o:l}),b&&this.drawTool(b,w)},this.drawTool=(t,e)=>{const{x:n,y:i}=e,{bgImg:o,title:s,x:r,y:a,corner:h,width:c,height:l}=t,d=n+r,u=i+a,f=c/2,v=l/2;o?this.drawImage(o,d,u,f,v):this.drawRoundedRect({x:d,y:u,r:h,active:!1,hWidth:f,hHeight:v,bgColor:null==t?void 0:t.bgColor,aBgColor:null==t?void 0:t.activeBgColor,shadowColor:null==t?void 0:t.shadowColor,shadowBlur:null==t?void 0:t.shadowBlur}),s&&this.drawText({x:d,y:u,title:s,active:!1,hWidth:f,r:h})},this.drawLineInCanvas=(t,e)=>{const{nodes:n,activeLines:i,rectCfg:o,lineCfg:s}=this,{key:r}=t,{height:a}=o,{width:h,label:c}=s,l=this.getRectIndex(t.toNodes[e]),d=t.toNodes[e],u=n[l];if(u){const e=i.find(t=>{const{fromNodes:e,toNodes:n}=t;return e===r&&n===d});let n=!1;if(this.editLine){const{fromNodes:t,toNodes:e}=this.editLine;n=t===r&&e===d}this.drawLine({sx:t.x,sy:t.y,x:u.x,y:u.y,_w:h,_h:a/2,active:!!e,aColor:n?"red":"orange",label:c}),this.dragTriangle({sy:t.y,x:u.x,y:u.y,_w:h,_h:a/2,_xDev:2.5*(null!=h?h:2),active:!!e,aColor:n?"red":"orange"})}},this.getXY=t=>{switch(t.length){case 1:return{x:t[0],x2:t[0],y:t[0],y2:t[0]};case 2:return{x:t[1],x2:t[1],y:t[0],y2:t[0]};case 3:return{x:t[1],x2:t[1],y:t[0],y2:t[2]};case 4:return{x:t[3],x2:t[1],y:t[0],y2:t[2]};default:return{x:0,x2:0,y:0,y2:0}}},this.ctx=e.getContext("2d"),this.nodes=t,this.canvas=e,this.wrapper=n,this.lineCfg=null!=o?o:{},this.rectCfg=null!=i?i:{},this.gradConfig=s,this.onDBClick=a,this.onChange=r,this.onChangePosition=h,this.resetValues(),this.initListenEvent()}resetValues(){this.singleClick=!0,this.cancelDBClick=!1,this.leftMouseDown=!1,this.mouseDownXY={x:0,y:0},this.editLine=null,this.lastMouseUpTime=0,this.activeKey=null,this.activeLines=[],this.lineFormNodeKey=null,this.selectArea={startX:0,startY:0,endX:0,endY:0},this.render()}initListenEvent(){this.createResetBtn(),this.createLineBtn(),this.onListenKeyDown(),this.onListenKeyUp(),this.onListenOnMouseDown(),this.onListenDBClick()}onListenDBClick(){this.canvas.ondblclick=t=>{var e,n;if(this.cancelDBClick)this.cancelDBClick=!1;else{const{offsetY:i,offsetX:o}=t,{translateX:s,translateY:r}=this,a=this.findRectInCanvas(o-s,i-r);this.mouseDownXY.x=o-s,this.mouseDownXY.y=i-r,this.findEditLine(),this.findToolInCanvas(o-s,i-r),a&&(null===(e=this.onDBClick)||void 0===e||e.call(this,{node:a,type:"node"})),this.activeTool&&this.onDBClick&&this.onDBClick({type:"tool",node:this.activeTool}),this.editLine&&(null===(n=this.onDBClick)||void 0===n||n.call(this,{type:"line",node:this.editLine}))}}}createResetBtn(){const t=window.document.createElement("div");t.innerHTML="<div>还原</div>",t.setAttribute("class","flow-reset-btn flow-btn"),t.onclick=()=>{this.resetPosition()},this.wrapper.appendChild(t)}createLineBtn(){const t=window.document.createElement("div");t.innerHTML="<div>画线</div>",t.setAttribute("class","flow-line-btn flow-btn"),t.onclick=()=>{this.onDrawLine()},this.drawElement=t,this.wrapper.appendChild(t)}onDrawLine(){this.drawElement&&(this.drawLineModel?(this.drawElement.innerHTML="<div>画线</div>",this.drawLineModel=!1):(this.drawElement.innerHTML="<div>取消</div>",this.drawLineModel=!0))}resize(t){this.canvas.width=t.width,this.canvas.height=t.height,this.render()}resetPosition(){this.translateX=0,this.translateY=0,this.render()}getRectIndex(t){var e;let n=0;const{nodes:i}=this;for(let o=0;o<=(null==i?void 0:i.length)-1;o++)if((null===(e=i[o])||void 0===e?void 0:e.key)===t)return n=o,n;return n}initCanvas(){var t;const{nodes:e,ctx:n}=this;if(n&&e)for(let n=0;n<=(null==e?void 0:e.length)-1;n++){this.drawNodeInCanvas(n);const i=e[n];for(let e=0;e<=(null===(t=i.toNodes)||void 0===t?void 0:t.length)-1;e++)this.drawLineInCanvas(i,e)}}deleLine(){var t,e,n;const{nodes:i,activeLines:o}=this;for(let n=0;n<=(null==o?void 0:o.length)-1;n++){const s=this.getRectIndex(null===(t=o[n])||void 0===t?void 0:t.fromNodes);i[s]&&(i[s].toNodes=null===(e=i[s])||void 0===e?void 0:e.toNodes.filter(t=>t!==o[n].toNodes))}null===(n=this.onChange)||void 0===n||n.call(this,i),this.activeLines=[]}deleRect(){var t;const{nodes:e}=this;for(let t=0;t<=(null==e?void 0:e.length)-1;t++)e[t].toNodes=e[t].toNodes.filter(t=>t!==this.activeKey);const n=this.getRectIndex(this.activeKey);e.splice(n,1),null===(t=this.onChange)||void 0===t||t.call(this,e),this.activeKey=null}findToolInCanvas(t,e){var n,i;let o=null;const{nodes:s}=this,{tool:r}=this.rectCfg;for(let a=(null==s?void 0:s.length)-1;a>=0;a--){const h=null!==(i=null===(n=s[a])||void 0===n?void 0:n.tool)&&void 0!==i?i:r;if(h){const{x:n=0,y:i=0,corner:r=0,width:c=0,height:l=0}=h,d=s[a].x+n-t,u=s[a].y+i-e,f=c/2,v=l/2,p=Math.sqrt(Math.pow(d,2)+Math.pow(u,2)),g=Math.sqrt(Math.pow(f-r,2)+Math.pow(v-r,2))+r;if(t<s[a].x+n+f&&t>s[a].x+n-f&&e<s[a].y+v+i&&e>s[a].y-v+i&&p<g&&s[a].key!==this.activeKey){o={point:s[a],key:s[a].key};break}}}this.activeTool=o}findRectInCanvas(t,e){var n;const{nodes:i,rectCfg:o}=this,{width:s,height:r,corner:a}=o,h=s/2||50,c=r/2||15;for(let o=(null==i?void 0:i.length)-1;o>=0;o--){const s=i[o].corner?null!==(n=i[o].corner)&&void 0!==n?n:0:null!=a?a:0,r=Math.sqrt(Math.pow(i[o].x-t,2)+Math.pow(i[o].y-e,2)),l=Math.sqrt(Math.pow(h-s,2)+Math.pow(c-s,2))+s;if(t<i[o].x+h&&t>i[o].x-h&&e<i[o].y+c&&e>i[o].y-c&&r<l)return{point:i[o],key:i[o].key}}}findLeftRightLine(t,e,n){const{startY:i,endY:o,endX:s,startX:r}=this.selectArea,a=t<s&&t>r;if(e>n){if(e>o&&n<i)return a&&!0}else if(n>o&&e<i)return a&&!0;return(e>i&&e<o||n>i&&n<o)&&a&&!0}findCenterLine(t,e,n){const{startY:i,endY:o,endX:s,startX:r}=this.selectArea,a=e<o&&e>i;return t>r&&t<s||n>r&&n<s?a&&!0:(t<r&&n>r||n>s&&t<s)&&a&&!0}findEditLine(){var t,e,n;this.editLine=null;const{x:i,y:o}=this.mouseDownXY;for(let s=0;s<=(null===(t=this.activeLines)||void 0===t?void 0:t.length)-1;s++){let t=null===(e=this.activeLines[s])||void 0===e?void 0:e.x,r=null===(n=this.activeLines[s])||void 0===n?void 0:n.y;i>t-20&&i<t+20&&o>r-5&&o<r+5&&(this.editLine=this.activeLines[s])}this.render()}findLineInCanvas(){var t;const{nodes:e,rectCfg:n}=this,{height:i}=n;this.activeLines=[],this.editLine=null;for(let n=(null==e?void 0:e.length)-1;n>=0;n--)for(let o=0;o<=(null===(t=e[n].toNodes)||void 0===t?void 0:t.length)-1;o++){const t=e[n].x,s=e[n].y,r=this.getRectIndex(e[n].toNodes[o]),a=e[r].x,h=e[r].y;let c,l,d,u;const f=i/2||15,v=f+15;if(s>h&&s>h+v||s<h&&s<h-v){const t=(s-h)/2;c=s<h?s+Math.abs(t):h+Math.abs(t)}else c=s<h?s-15-f:s+15;if(t<a?(l=this.findLeftRightLine(t,s,c),u=this.findCenterLine(t,c,a),d=this.findLeftRightLine(a,h,c)):(l=this.findLeftRightLine(a,h,c),u=this.findCenterLine(a,c,t),d=this.findLeftRightLine(t,s,c)),l||u||d){let i=t<a?t+(a-t)/2:a+(t-a)/2;this.activeLines.push({fromNodes:e[n].key,toNodes:e[n].toNodes[o],x:i,y:c})}}this.render()}drawText({x:t=0,y:e=0,title:n="",active:i=!1,hWidth:o=50,txtColor:s="black",aTextColor:r="white",fontSize:a="11px",margin:h=[0,0,0,0],align:c="center",r:l=5}){if(this.ctx){this.ctx.fillStyle=s,this.ctx.font=a+" Arial";let d=0,u=0;const f=this.getXY(h),v=this.ctx.measureText(n).width,p=l<5?5:l;"center"===c?d=t-v/2+(null==f?void 0:f.x)-(null==f?void 0:f.x2):"left"===c?d=t-o+p+(null==f?void 0:f.x)-(null==f?void 0:f.x2):"right"===c&&(d=t+(o-v)-p+(null==f?void 0:f.x)-(null==f?void 0:f.x2)),u=e+(null==f?void 0:f.y)-(null==f?void 0:f.y2),i&&(this.ctx.fillStyle=r),this.ctx.fillText(n,d,u)}}drawLine({sx:t=0,sy:e=0,x:n=0,y:i=0,active:o=!1,_h:s=15,_w:r=2,color:a="#50a9ff",aColor:h="orange",label:c}){this.ctx&&(this.ctx.save(),this.ctx.beginPath(),e>i&&e>i+s+30||e<i&&e<i-s-30?(e>i?this.ctx.moveTo(t,e-s):this.ctx.moveTo(t,e+s),this.ctx.lineTo(t,e+(i-e)/2),this.ctx.lineTo(n,e+(i-e)/2)):(e>i?this.ctx.moveTo(t,e+s):this.ctx.moveTo(t,e-s),this.ctx.lineTo(t,e+(e>i?30:-30)),this.ctx.lineTo(n,e+(e>i?30:-30))),e>i?this.ctx.lineTo(n,i+s):this.ctx.lineTo(n,i-s),this.ctx.lineWidth=r,this.ctx.strokeStyle=a,o&&(this.ctx.strokeStyle=h),this.ctx.stroke(),this.ctx.restore(),c&&o&&this.drawLineRect(t,e,n,i))}dragTriangle({sy:t=0,x:e=0,y:n=0,_w:i=2,_h:o=15,_xDev:s=5,color:r="#50a9ff",aColor:a="orange",active:h=!1}){if(this.ctx){const c=Math.sqrt(Math.pow(2*s,2)-Math.pow(s,2));this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=r,h&&(this.ctx.fillStyle=a),this.ctx.moveTo(e,n-(t-n>0?-o:o)),this.ctx.lineTo(e-s,n-(t-n>0?-o-c:o+c)),this.ctx.lineTo(e+s,n-(t-n>0?-o-c:o+c)),this.ctx.lineTo(e,n-(t-n>0?-o:o)),this.ctx.lineWidth=i,this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()}}drawLineRect(t,e,n,i){const{lineCfg:o}=this,{label:s}=o;if(s){const{width:o=0,height:r=0,title:a="",bgColor:h="red",corner:c=0,bgImg:l,shadowBlur:d,shadowColor:u,textMargin:f,textAlign:v}=s,p=Math.abs((t-n)/2),g=t>n?n+p:t+p,x=r/2+30;let y=0;y=e>i&&e>i+x||e<i&&e<i-x?e+(i-e)/2:e+(e>i?30:-30),l?this.drawImage(l,g,y,o,r):this.drawRoundedRect({x:g,y:y,r:c,hWidth:o,hHeight:r,bgColor:h,shadowBlur:d,shadowColor:u}),a&&this.drawText({x:g,y:y,title:a,hWidth:o,r:c,align:v,margin:f})}}drawRoundedRect({x:t=0,y:e=0,r:n=0,active:i=!1,bgImg:o,hWidth:s=50,hHeight:r=15,shadowBlur:a,shadowColor:h="rgba(0,0,0,0.3)",bgColor:c="white",aBgColor:l="#50a9ff"}){this.ctx&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(t-s+n,e-r),this.ctx.lineTo(t+s-n,e-r),this.ctx.arcTo(t+s,e-r,t+s,e+n,n),this.ctx.lineTo(t+s,e+r-n),this.ctx.arcTo(t+s,e+r,t+s-n,e+r,n),this.ctx.lineTo(t-s+n,e+r),this.ctx.arcTo(t-s,e+r,t-s,e+r-n,n),this.ctx.lineTo(t-s,e-r+n),this.ctx.arcTo(t-s,e-r,t-s+n,e-r,n),a&&(this.ctx.shadowBlur=a),a&&(this.ctx.shadowColor=h),!i&&(this.ctx.fillStyle=c),i&&(this.ctx.fillStyle=l),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore(),o&&this.drawImage(o,t,e,s,r))}drawImage(t,e=0,n=0,i=50,o=15){this.ctx&&t&&this.ctx.drawImage(t,e-i,n-o,2*i,2*o)}dragSelect(t=0,e=0,n=0,i=0){this.ctx&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.setLineDash([8,8]),this.ctx.moveTo(t,e),this.ctx.lineTo(n,e),this.ctx.lineTo(n,i),this.ctx.lineTo(t,i),this.ctx.lineTo(t,e),this.ctx.lineWidth=2,this.ctx.strokeStyle="#999",this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore())}drawDrid(){if(this.ctx){const{width:t,height:e}=this.canvas,{color:n="#dddddd",space:i=100,width:o=.5,type:s="point",stepX:r=20,stepY:a=20}=this.gradConfig;if(this.ctx.save(),this.ctx.strokeStyle=n,"line"===s){this.ctx.lineWidth=o;for(let n=-i;n<t+i;n+=r)this.ctx.beginPath(),this.ctx.moveTo(n,0),this.ctx.lineTo(n,e+i),this.ctx.closePath(),this.ctx.stroke();for(let n=-i;n<e+i;n+=a)this.ctx.beginPath(),this.ctx.moveTo(0,n),this.ctx.lineTo(t+i,n),this.ctx.closePath(),this.ctx.stroke()}else for(let s=-i;s<t+i;s+=r)for(let t=-i;t<e+i;t+=a)this.ctx.beginPath(),this.ctx.arc(s,t,o,0,Math.PI),this.ctx.fillStyle=n,this.ctx.fill(),this.ctx.closePath(),this.ctx.stroke();this.ctx.restore()}}}},function(t,e,n){"use strict";n.r(e),function(t){var n=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var n=-1;return t.some((function(t,i){return t[0]===e&&(n=i,!0)})),n}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var n=t(this.__entries__,e),i=this.__entries__[n];return i&&i[1]},e.prototype.set=function(e,n){var i=t(this.__entries__,e);~i?this.__entries__[i][1]=n:this.__entries__.push([e,n])},e.prototype.delete=function(e){var n=this.__entries__,i=t(n,e);~i&&n.splice(i,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var n=0,i=this.__entries__;n<i.length;n++){var o=i[n];t.call(e,o[1],o[0])}},e}()}(),i="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,o=void 0!==t&&t.Math===Math?t:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),s="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(o):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)};var r=["top","right","bottom","left","width","height","size","weight"],a="undefined"!=typeof MutationObserver,h=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var n=!1,i=!1,o=0;function r(){n&&(n=!1,t()),i&&h()}function a(){s(r)}function h(){var t=Date.now();if(n){if(t-o<2)return;i=!0}else n=!0,i=!1,setTimeout(a,e);o=t}return h}(this.refresh.bind(this),20)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,n=e.indexOf(t);~n&&e.splice(n,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},t.prototype.connect_=function(){i&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),a?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){i&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,n=void 0===e?"":e;r.some((function(t){return!!~n.indexOf(t)}))&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),c=function(t,e){for(var n=0,i=Object.keys(e);n<i.length;n++){var o=i[n];Object.defineProperty(t,o,{value:e[o],enumerable:!1,writable:!1,configurable:!0})}return t},l=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||o},d=x(0,0,0,0);function u(t){return parseFloat(t)||0}function f(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.reduce((function(e,n){return e+u(t["border-"+n+"-width"])}),0)}function v(t){var e=t.clientWidth,n=t.clientHeight;if(!e&&!n)return d;var i=l(t).getComputedStyle(t),o=function(t){for(var e={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var o=i[n],s=t["padding-"+o];e[o]=u(s)}return e}(i),s=o.left+o.right,r=o.top+o.bottom,a=u(i.width),h=u(i.height);if("border-box"===i.boxSizing&&(Math.round(a+s)!==e&&(a-=f(i,"left","right")+s),Math.round(h+r)!==n&&(h-=f(i,"top","bottom")+r)),!function(t){return t===l(t).document.documentElement}(t)){var c=Math.round(a+s)-e,v=Math.round(h+r)-n;1!==Math.abs(c)&&(a-=c),1!==Math.abs(v)&&(h-=v)}return x(o.left,o.top,a,h)}var p="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof l(t).SVGGraphicsElement}:function(t){return t instanceof l(t).SVGElement&&"function"==typeof t.getBBox};function g(t){return i?p(t)?function(t){var e=t.getBBox();return x(0,0,e.width,e.height)}(t):v(t):d}function x(t,e,n,i){return{x:t,y:e,width:n,height:i}}var y=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=x(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=g(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),w=function(t,e){var n,i,o,s,r,a,h,l=(i=(n=e).x,o=n.y,s=n.width,r=n.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,h=Object.create(a.prototype),c(h,{x:i,y:o,width:s,height:r,top:o,right:i+s,bottom:r+o,left:i}),h);c(this,{target:t,contentRect:l})},b=function(){function t(t,e,i){if(this.activeObservations_=[],this.observations_=new n,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=i}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof l(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new y(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof l(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(e){e.isActive()&&t.activeObservations_.push(e)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map((function(t){return new w(t.target,t.broadcastRect())}));this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),m="undefined"!=typeof WeakMap?new WeakMap:new n,_=function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=h.getInstance(),i=new b(e,n,this);m.set(this,i)};["observe","unobserve","disconnect"].forEach((function(t){_.prototype[t]=function(){var e;return(e=m.get(this))[t].apply(e,arguments)}}));var C=void 0!==o.ResizeObserver?o.ResizeObserver:_;e.default=C}.call(this,n(5))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var i=n(7),o=n(8);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[t.i,o,""]]);var s={insert:"head",singleton:!1};i(o,s);t.exports=o.locals||{}},function(t,e,n){"use strict";var i,o=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},s=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),r=[];function a(t){for(var e=-1,n=0;n<r.length;n++)if(r[n].identifier===t){e=n;break}return e}function h(t,e){for(var n={},i=[],o=0;o<t.length;o++){var s=t[o],h=e.base?s[0]+e.base:s[0],c=n[h]||0,l="".concat(h," ").concat(c);n[h]=c+1;var d=a(l),u={css:s[1],media:s[2],sourceMap:s[3]};-1!==d?(r[d].references++,r[d].updater(u)):r.push({identifier:l,updater:g(u,e),references:1}),i.push(l)}return i}function c(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var o=n.nc;o&&(i.nonce=o)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var r=s(t.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(e)}return e}var l,d=(l=[],function(t,e){return l[t]=e,l.filter(Boolean).join("\n")});function u(t,e,n,i){var o=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=d(e,o);else{var s=document.createTextNode(o),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(s,r[e]):t.appendChild(s)}}function f(t,e,n){var i=n.css,o=n.media,s=n.sourceMap;if(o?t.setAttribute("media",o):t.removeAttribute("media"),s&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var v=null,p=0;function g(t,e){var n,i,o;if(e.singleton){var s=p++;n=v||(v=c(e)),i=u.bind(null,n,s,!1),o=u.bind(null,n,s,!0)}else n=c(e),i=f.bind(null,n,e),o=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else o()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=o());var n=h(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<n.length;i++){var o=a(n[i]);r[o].references--}for(var s=h(t,e),c=0;c<n.length;c++){var l=a(n[c]);0===r[l].references&&(r[l].updater(),r.splice(l,1))}n=s}}}},function(t,e,n){(e=n(9)(!1)).push([t.i,".flow-reset-btn {\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  z-index: 99;\n  color: #fff;\n  background: #499af2;\n  border-color: #499af2;\n  text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.12);\n  -webkit-box-shadow: 0 0.10417vw 0 rgba(0, 0, 0, 0.045);\n  box-shadow: 0 0.10417vw 0 rgba(0, 0, 0, 0.045);\n}\n.flow-line-btn {\n  position: absolute;\n  top: 20px;\n  left: 20px;\n  z-index: 99;\n  color: #fff;\n  background: #499af2;\n  border-color: #499af2;\n  text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.12);\n  -webkit-box-shadow: 0 0.10417vw 0 rgba(0, 0, 0, 0.045);\n  box-shadow: 0 0.10417vw 0 rgba(0, 0, 0, 0.045);\n}\n.flow-btn {\n  padding: 4px 6px;\n  font-size: 11px;\n  border-radius: 2px;\n  cursor: pointer;\n  user-select: none;\n}\n",""]),t.exports=e},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var o=(r=i,a=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(h," */")),s=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[n].concat(s).concat([o]).join("\n")}var r,a,h;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var o={};if(i)for(var s=0;s<this.length;s++){var r=this[s][0];null!=r&&(o[r]=!0)}for(var a=0;a<t.length;a++){var h=[].concat(t[a]);i&&o[h[0]]||(n&&(h[2]?h[2]="".concat(n," and ").concat(h[2]):h[2]=n),e.push(h))}},e}}])}));