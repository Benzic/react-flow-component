(this["webpackJsonpreact-flow-component"]=this["webpackJsonpreact-flow-component"]||[]).push([[0],{12:function(e,t,n){},13:function(e,t,n){},14:function(e,t,n){"use strict";n.r(t);var l=n(1),i=n(2),o=n(0),a=n.n(o),c=n(6);function r(e,t,n,l,i,o){var a,c;t.fillStyle="black",t.font=(null===e||void 0===e?void 0:e.fontSize)?(null===e||void 0===e?void 0:e.fontSize)+" Arial":"12px Arial",o&&(t.fillStyle="white");var r=t.measureText(i).width;t.fillText(i,n-(null!==(a=null===e||void 0===e?void 0:e.xText)&&void 0!==a?a:r/2),l+(null!==(c=null===e||void 0===e?void 0:e.yText)&&void 0!==c?c:5))}function d(e,t,n,l,i,o,a,c){var d,v,s,u=i||(null!==(d=null===e||void 0===e?void 0:e.corner)&&void 0!==d?d:0),f=(null===e||void 0===e?void 0:e.width)/2||50,y=(null===e||void 0===e?void 0:e.height)/2||15;console.log(f,y),t.save(),t.beginPath(),t.moveTo(n-f+u,l-y),t.lineTo(n+f-u,l-y),t.arcTo(n+f,l-y,n+f,l+u,u),t.lineTo(n+f,l+y-u),t.arcTo(n+f,l+y,n+f-u,l+y,u),t.lineTo(n-f+u,l+y),t.arcTo(n-f,l+y,n-f,l+y-u,u),t.lineTo(n-f,l-y+u),t.arcTo(n-f,l-y,n-f+u,l-y,u),t.fillStyle=null!==(v=null===e||void 0===e?void 0:e.BgColor)&&void 0!==v?v:"white",a&&(t.fillStyle=null!==(s=null===e||void 0===e?void 0:e.activeBgColor)&&void 0!==s?s:"#40a9ff"),t.fill(),t.closePath(),t.restore(),c?function(e,t,n,l,i,o,a){var c=(null===n||void 0===n?void 0:n.width)/2||50,d=(null===n||void 0===n?void 0:n.height)/2||15,v=new Image;v.src=t,v.onload=function(){var t,s;e.drawImage(v,l-c,i-d,null!==(t=null===n||void 0===n?void 0:n.width)&&void 0!==t?t:50,null!==(s=null===n||void 0===n?void 0:n.height)&&void 0!==s?s:30),o&&r(n,e,l,i,o,a)}}(t,c,e,n,l,o,a):o&&r(e,t,n,l,o,a)}function v(e,t,n,l,i){e.save(),e.beginPath(),e.setLineDash([8,8]),e.moveTo(t,n),e.lineTo(l,n),e.lineTo(l,i),e.lineTo(t,i),e.lineTo(t,n),e.lineWidth=2,e.strokeStyle="#999",e.closePath(),e.stroke(),e.restore()}function s(e,t,n,l,i,o,a){var c,r,d,v,s=(null===t||void 0===t?void 0:t.height)/2||15,u=2.5*(null!==(c=null===e||void 0===e?void 0:e.width)&&void 0!==c?c:2),f=Math.sqrt(Math.pow(2*u,2)-Math.pow(u,2));n.save(),n.beginPath(),n.fillStyle=null!==(r=null===e||void 0===e?void 0:e.color)&&void 0!==r?r:"#40a9ff",a&&(n.fillStyle=null!==(d=null===e||void 0===e?void 0:e.activeColor)&&void 0!==d?d:"orange"),n.moveTo(i,o-(l-o>0?-s:s)),n.lineTo(i-u,o-(l-o>0?-s-f:s+f)),n.lineTo(i+u,o-(l-o>0?-s-f:s+f)),n.lineTo(i,o-(l-o>0?-s:s)),n.lineWidth=null!==(v=null===e||void 0===e?void 0:e.width)&&void 0!==v?v:2,n.closePath(),n.fill(),n.restore()}function u(e,t,n,l,i,o,a,c){var r,d,v,s=(null===t||void 0===t?void 0:t.height)/2||15;n.save(),n.beginPath(),n.moveTo(l,i),i>a&&i>a+s||i<a&&i<a-s||!s?(n.lineTo(l,i+(a-i)/2),n.lineTo(o,i+(a-i)/2)):(n.lineTo(l,i+(i>a?t+25:-t-25)),n.lineTo(o,i+(i>a?t+25:-t-25))),n.lineTo(o,a),n.lineWidth=null!==(r=null===e||void 0===e?void 0:e.width)&&void 0!==r?r:2,n.strokeStyle=null!==(d=null===e||void 0===e?void 0:e.color)&&void 0!==d?d:"#40a9ff",c&&(n.strokeStyle=null!==(v=null===e||void 0===e?void 0:e.activeColor)&&void 0!==v?v:"orange"),n.stroke(),n.restore()}var f={activeMoveRect:null,activeDeleRect:null,activeLine:{key:null,toKey:null},singleClick:!0,lastClickTime:null,mouseDownXY:{x:0,y:0},selectArea:{startX:0,startY:0,endX:0,endY:0},nodes:[],canvas:null,rectCfg:null,lineCfg:null,ctx:null,onChange:null,checkKeyDown:function(e){46===e.keyCode&&(null!==f.activeLine.key&&f.deleLine(),null!==f.activeDeleRect&&f.deleRect(),f.initCanvas())},getRectIndex:function(e){for(var t=0,n=f.nodes,l=0;l<=n.length-1;l++)n[l].key===e&&(t=l);return t},initCanvas:function(){var e,t;console.log(f.nodes);var n=f.nodes;f.ctx.clearRect(0,0,null===(e=f.canvas)||void 0===e?void 0:e.width,null===(t=f.canvas)||void 0===t?void 0:t.height);for(var l=0;l<=n.length-1;l++)for(var i=0;i<=n[l].to.length-1;i++){var o=n[f.getRectIndex(n[l].to[i])];if(o){var a=n[l];u(f.lineCfg,f.rectCfg,f.ctx,a.x,a.y,o.x,o.y,f.activeLine.key===a.key&&f.activeLine.toKey===a.to[i]),s(f.lineCfg,f.rectCfg,f.ctx,a.y,o.x,o.y,f.activeLine.key===a.key&&f.activeLine.toKey===a.to[i])}}console.log("1");for(var c=0;c<=n.length-1;c++){var r,v,y=n[c];d(f.rectCfg,f.ctx,y.x,y.y,y.corner,y.title,f.activeMoveRect===y.key,null!==(r=y.bgImg)&&void 0!==r?r:null===(v=f.rectCfg)||void 0===v?void 0:v.bgImg)}},deleLine:function(){var e=f.nodes,t=f.getRectIndex(f.activeLine.key);e[t]&&(e[t].to=e[t].to.filter((function(e){return e!==f.activeLine.toKey})),f.onChange&&f.onChange(e),f.activeLine={key:null,toKey:null})},deleRect:function(){for(var e=f.nodes,t=0;t<=e.length-1;t++)for(var n=0;n<=e[t].to.length-1;n++)e[t].to[n]===f.activeDeleRect&&(e[t].to=e[t].to.splice(f.getRectIndex(f.activeDeleRect),1));var l=f.getRectIndex(f.activeDeleRect);e.splice(l,1),f.onChange&&f.onChange(e),f.activeDeleRect=null},findRectInCanvas:function(e,t){for(var n,l,i=null,o=f.nodes,a=(null===(n=f.rectCfg)||void 0===n?void 0:n.width)/2||50,c=(null===(l=f.rectCfg)||void 0===l?void 0:l.height)/2||15,r=0;r<=o.length-1;r++){var d,v,s=o[r].corner?o[r].corner:null!==(d=null===(v=f.rectCfg)||void 0===v?void 0:v.corner)&&void 0!==d?d:0,u=Math.sqrt(Math.pow(o[r].x-e,2)+Math.pow(o[r].y-t,2)),y=Math.sqrt(Math.pow(a-s,2)+Math.pow(c-s,2))+s;if(e<o[r].x+a&&e>o[r].x-a&&t<o[r].y+c&&t>o[r].y-c&&u<y&&o[r].key!==f.activeMoveRect){i={point:o[r],key:o[r].key};break}}return i},findLineInCanvas:function(){for(var e={},t=f.nodes,n=0;n<=t.length-1;n++)for(var l=0;l<=t[n].to.length-1;l++){var i=t[n].x,o=t[n].y,a=f.getRectIndex(t[n].to[l]),c=t[a].x,r=t[a].y,d=void 0,v=void 0,s=void 0,u=void 0,y=void 0;if(o<r?(d=o+(r-o)/2,y=i<f.selectArea.endX&&i>f.selectArea.startX&&d<f.selectArea.endY&&d>f.selectArea.startY,v=i<f.selectArea.endX&&i>f.selectArea.startX&&f.selectArea.startY>o&&f.selectArea.startY<d,s=f.selectArea.startX<c&&f.selectArea.endX>c&&f.selectArea.endY>d&&f.selectArea.endY<r):(d=r+(o-r)/2,y=i<f.selectArea.endX&&i>f.selectArea.startX&&d<f.selectArea.endY&&d>f.selectArea.startY,v=f.selectArea.endX>i&&f.selectArea.startX<i&&f.selectArea.startY>d&&f.selectArea.startY<o,s=f.selectArea.startX<c&&f.selectArea.endX>c&&f.selectArea.endY<d&&f.selectArea.endY>r),u=i>c?f.selectArea.endX>c&&f.selectArea.endX<i&&f.selectArea.endY>d&&f.selectArea.startY<d:f.selectArea.endX>i&&f.selectArea.endX<c&&f.selectArea.endY>d&&f.selectArea.startY<d,v||u||s||y){e={key:t[n].key,toKey:t[n].to[l]};break}}f.activeLine=e,f.initCanvas(f.rectCfg,f.lineCfg,f.ctx,f.canvas,t)}},y=f,g=function(e){var t=e.selectedKeys,n=void 0===t?[]:t,i=(e.mode,e.rectConfig),c=e.lineCofig,r=e.onChange,d=e.onEdit,s=Object(o.useRef)(null),f=Object(o.useRef)(null);Object(o.useEffect)((function(){y.rectCfg=i,y.lineCfg=c,y.onChange=r,window.addEventListener("keydown",y.checkKeyDown,!0),console.log(i,"-"),(null===i||void 0===i?void 0:i.edit)&&window.addEventListener("dblclick",(function(){var e=y.getRectIndex(y.activeMoveRect),t={node:y.nodes[e],index:e};d&&d(t)}),!0)}),[i,c,r,d]),Object(o.useEffect)((function(){console.log(n),y.nodes=n,y.ctx&&y.initCanvas()}),[n]);var g=Object(o.useCallback)((function(e){var t=e.offsetX,n=e.offsetY;if(null!==y.activeMoveRect){var l=y.getRectIndex(y.activeMoveRect);if(y.singleClick){var i,o,a,c,r,d,s,f;if(y.nodes[l].active)y.nodes[l].x=Math.floor(t/(null!==(i=null===(o=y.rectCfg)||void 0===o?void 0:o.xCorrecting)&&void 0!==i?i:10))*(null!==(a=null===(c=y.rectCfg)||void 0===c?void 0:c.xCorrecting)&&void 0!==a?a:10),y.nodes[l].y=Math.floor(n/(null!==(r=null===(d=y.rectCfg)||void 0===d?void 0:d.yCorrecting)&&void 0!==r?r:5))*(null!==(s=null===(f=y.rectCfg)||void 0===f?void 0:f.yCorrecting)&&void 0!==s?s:5);y.initCanvas()}else y.initCanvas(),u(y.lineCfg,y.rectCfg,y.ctx,y.nodes[l].x,y.nodes[l].y,t,n)}else y.activeDeleRect=null,y.initCanvas(),y.startX=y.mouseDownXY.x,y.selectArea.startY=y.mouseDownXY.y,y.selectArea.endX=t,y.selectArea.endY=n,v(y.ctx,y.mouseDownXY.x,y.mouseDownXY.y,t,n)}),[]),h=Object(o.useCallback)((function(){s.current.onmousemove=g,s.current.onmouseup=function(e){var t=e.offsetX,n=e.offsetY;if(null===y.activeMoveRect||y.singleClick)null===y.activeMoveRect&&y.findLineInCanvas();else{var i=y.findRectInCanvas(t,n),o=y.getRectIndex(y.activeMoveRect);i&&(y.nodes[o].to=[].concat(Object(l.a)(y.nodes[o].to),[i.key]),y.nodes[o].active=!1,r&&r(y.nodes)),y.initCanvas()}y.activeMoveRect=null,s.current.onmousemove=null,s.current.onmouseup=null}}),[g,r]),k=Object(o.useCallback)((function(e){var t=e.offsetX,n=e.offsetY;y.lastClickTime&&(y.singleClick=!((new Date).valueOf()-y.lastClickTime.valueOf()<250)),y.lastClickTime=new Date,y.mouseDownXY.x=t,y.mouseDownXY.y=n;var l=y.findRectInCanvas(t,n);if(l){y.activeMoveRect=null===l||void 0===l?void 0:l.key,y.activeDeleRect=null===l||void 0===l?void 0:l.key;var i=y.getRectIndex(null===l||void 0===l?void 0:l.key),o=y.nodes[i];y.nodes[i].active=!0,y.nodes.splice(i,1),y.nodes.push(o),r&&r(y.nodes),y.initCanvas()}h()}),[h,r]);return Object(o.useEffect)((function(){console.log(f.current),f.current&&(y.canvas=s.current,s.current.width=f.current.offsetWidth,s.current.height=f.current.offsetHeight,y.canvas.width=f.current.offsetWidth,y.canvas.height=f.current.offsetHeight,y.ctx=s.current.getContext("2d"),s.current.onmousedown=k,y.initCanvas())}),[k]),a.a.createElement("div",{ref:f,style:{width:"100%",height:"100%"}},a.a.createElement("canvas",{ref:s,id:"canvas"}))},h=(n(12),n(13),[{title:"\u68c0\u6d4b\u96c6\u4e2d\u6027\u5206\u6790",key:"0-0",children:[{title:"\u5206\u6790\u5b50\u9879A01",key:"0-0-1",type:1},{title:"\u5206\u6790\u5b50\u9879A02",key:"0-0-2",type:1},{title:"\u5206\u6790\u5b50\u9879A03",key:"0-0-3",type:2},{title:"\u5206\u6790\u5b50\u9879A04",key:"0-0-4",type:2}]},{title:"Map\u5206\u6790",key:"0-1",children:[{title:"\u5206\u6790\u5b50\u9879B01",key:"0-1-1",type:1},{title:"\u5206\u6790\u5b50\u9879B02",key:"0-1-2",type:1},{title:"\u5206\u6790\u5b50\u9879B03",key:"0-1-3",type:2},{title:"\u5206\u6790\u5b50\u9879B04",key:"0-1-4",type:2}]},{title:"\u5de5\u827a\u8def\u5f84\u5206\u6790",key:"0-2",children:[{title:"\u5206\u6790\u5b50\u9879C01",key:"0-2-1",type:1},{title:"\u5206\u6790\u5b50\u9879C02",key:"0-2-2",type:1},{title:"\u5206\u6790\u5b50\u9879C03",key:"0-2-3",type:2},{title:"\u5206\u6790\u5b50\u9879C04",key:"0-2-4",type:2}]},{title:"\u5de5\u827a\u5c65\u5386\u5206\u6790",key:"0-3",children:[{title:"\u5206\u6790\u5b50\u9879D01",key:"0-3-1",type:1},{title:"\u5206\u6790\u5b50\u9879D02",key:"0-3-2",type:1},{title:"\u5206\u6790\u5b50\u9879D03",key:"0-3-3",type:2},{title:"\u5206\u6790\u5b50\u9879D04",key:"0-3-4",type:2}]},{title:"\u8fc7\u7a0b\u54c1\u8d28\u5206\u6790",key:"0-4",children:[{title:"\u5206\u6790\u5b50\u9879E01",key:"0-4-1",type:1},{title:"\u5206\u6790\u5b50\u9879E02",key:"0-4-2",type:1},{title:"\u5206\u6790\u5b50\u9879E03",key:"0-4-3",type:2},{title:"\u5206\u6790\u5b50\u9879E04",key:"0-4-4",type:2}]},{title:"\u5de5\u827a\u53c2\u6570\u5206\u6790",key:"0-5",children:[{title:"\u5206\u6790\u5b50\u9879F01",key:"0-5-1",type:1},{title:"\u5206\u6790\u5b50\u9879F02",key:"0-5-2",type:1},{title:"\u5206\u6790\u5b50\u9879F03",key:"0-5-3",type:2},{title:"\u5206\u6790\u5b50\u9879F04",key:"0-5-4",type:2}]},{title:"\u5de5\u827a\u539f\u6599\u5206\u6790",key:"0-6",children:[{title:"\u5206\u6790\u5b50\u9879G01",key:"0-6-1",type:1},{title:"\u5206\u6790\u5b50\u9879G02",key:"0-6-2",type:1},{title:"\u5206\u6790\u5b50\u9879G03",key:"0-6-3",type:2},{title:"\u5206\u6790\u5b50\u9879G04",key:"0-6-4",type:2}]}]),k=function(){var e=Object(o.useState)([]),t=Object(i.a)(e,2),n=t[0],c=t[1],r=Object(o.useState)(0),d=Object(i.a)(r,2),v=d[0],s=d[1],u=Object(o.useState)(null),f=Object(i.a)(u,2),y=f[0],k=f[1],C=Object(o.useState)([]),p=Object(i.a)(C,2),w=p[0],x=p[1],m=Object(o.useState)(null),b=Object(i.a)(m,2),A=(b[0],b[1],Object(o.useRef)(null));return window.ondragstart=function(e){console.log(e),s(100);var t=e||window.event;k({x:t.clientX-t.target.offsetLeft,y:t.clientY-t.target.offsetTop,title:t.target.dataset.title,key:t.target.dataset.key})},window.ondragover=function(e){e.preventDefault()},window.ondragenter=function(e){e.preventDefault()},window.ondrop=function(e){var t=e||window.event,i=y.x,o=y.y;t.preventDefault(),s(0),JSON.stringify(n).includes('"key":"'+y.key+'"')||c([].concat(Object(l.a)(n),[{title:y.title,key:y.key,x:t.clientX-i+50-200,y:t.clientY-o+15,active:!1,to:[]}]))},a.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex"}},a.a.createElement("div",{style:{width:"100%",height:"100%",position:"absolute",left:0,top:0,zIndex:v}},h.map((function(e,t){return a.a.createElement("div",{className:"list_sub ".concat(w.includes(t)?"list_sub_active":""),ref:A,key:e.key},a.a.createElement("div",{draggable:!0,className:"list_title",onClick:function(){-1!==w.indexOf(t)?(w.splice(w.indexOf(t),1),x(w)):x([].concat(Object(l.a)(w),[t]))},key:e.key,"data-title":e.title,"data-key":e.key},e.title),e.children.map((function(e){return a.a.createElement("div",{draggable:!0,className:"list_child",key:e.key,"data-title":e.title,"data-key":e.key},e.title)})))}))),a.a.createElement("div",{style:{marginLeft:"200px",width:"calc(100% - 200px)",height:"100%",position:"relative",zIndex:"10",background:"#ddd"}},a.a.createElement(g,{selectedKeys:n})))};Object(c.render)(a.a.createElement(k,null),document.getElementById("root"))},7:function(e,t,n){e.exports=n(14)}},[[7,1,2]]]);
//# sourceMappingURL=main.8888c124.chunk.js.map